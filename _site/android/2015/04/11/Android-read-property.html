<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/daviddong.github.io/assets/css/style.css">
<link rel="icon" href="/daviddong.github.io/assets/favicon.ico">
<title>Read/Write system property in Android APP | David Dong's Blog</title>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Read/Write system property in Android APP | David Dong’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Read/Write system property in Android APP" />
<meta name="author" content="David Dong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Recently I need to read system property in my Android apk development. I checked the Android documents and found that Android has a Systemproperties class to handle this kind of requirement. However Systemproperties class isn’t a public class of SDK, which means it is invisible to the apk developer. My understanding is that google wants this class to be used for Android source developer rather than application developer." />
<meta property="og:description" content="Recently I need to read system property in my Android apk development. I checked the Android documents and found that Android has a Systemproperties class to handle this kind of requirement. However Systemproperties class isn’t a public class of SDK, which means it is invisible to the apk developer. My understanding is that google wants this class to be used for Android source developer rather than application developer." />
<link rel="canonical" href="http://localhost:4000/daviddong.github.io/android/2015/04/11/Android-read-property.html" />
<meta property="og:url" content="http://localhost:4000/daviddong.github.io/android/2015/04/11/Android-read-property.html" />
<meta property="og:site_name" content="David Dong’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-04-11T23:48:12+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/daviddong.github.io/android/2015/04/11/Android-read-property.html"},"@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/daviddong.github.io/BLOG"},"name":"David Dong"},"headline":"Read/Write system property in Android APP","dateModified":"2015-04-11T23:48:12+08:00","datePublished":"2015-04-11T23:48:12+08:00","author":{"@type":"Person","name":"David Dong"},"url":"http://localhost:4000/daviddong.github.io/android/2015/04/11/Android-read-property.html","description":"Recently I need to read system property in my Android apk development. I checked the Android documents and found that Android has a Systemproperties class to handle this kind of requirement. However Systemproperties class isn’t a public class of SDK, which means it is invisible to the apk developer. My understanding is that google wants this class to be used for Android source developer rather than application developer.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->




</head>
  <body><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><main class="container">
      <section class="about">
        <a href="/daviddong.github.io/blog/index.html"><img src="/daviddong.github.io/assets/avatar.png" alt="David Dong"></a>
        <h2 id="title">
          <a href="/daviddong.github.io/blog/index.html">David Dong</a>
        </h2>
        <p class="tagline">Java/C/C#/Python</p>
        <ul class="social">
		   <a href="https://rainbow-ux.github.io/traveler-blog.github.io">
              <li>
                <i class="icon-picture-3"></i>
              </li>
           </a><a href="https://github.com/gangdong">
              <li>
                <i class="icon-github-circled-1"></i>
              </li>
            </a><a href="https://www.linkedin.com/in/刚-董-25208ba0/">
              <li>
                <i class="icon-linkedin-squared"></i>
              </li>
            </a></ul><nav class="navigation">
            <ul>
              
            </ul>
          </nav><p>&copy;
          2021</p><div>
        <p style = "font-family: Raleway, sans-serif;font-size: 100%">Dark Theme
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" id="dark-mode-toggle" onclick="toggleDarkMode()">
            <span class="slider round"></span>
          </label>
        </p>
      </div>
      <script type="text/javascript" src="/daviddong.github.io/assets/js/darkmode.js"></script><div>
        <ul class="social" style="padding-top: 3vh"><a style ="margin-right:10px;text-decoration: none;font-family: Raleway, sans-serif;" href="/daviddong.github.io/rss.xml">
              <span class="icon-rss-1">rss</span>
           </a><a style="text-decoration: none;font-family: Raleway, sans-serif;" href="https://github.com/gangdong/daviddong.github.io">
              <span class="icon-file-code">code</span>
            </a></ul>
      </div>
      </section>
      <section class="content">
        <!-- add menu bar here! -->


<div class="post-container">
<div  class = "menu">
<div  style="font-size:180%;font-weight:800; margin-top: 20px">BLOG</div>
<div  style = "margin-top: 20px">
<a class = "menu_tag_a" href="/daviddong.github.io/blog/index.html">
    <span class="icon-doc-text icon_font">Posts</span>
</a><a  class = "menu_tag_a" href="/daviddong.github.io/archive">
    <span class="icon-archive-1 icon_font">Archives</span>
</a><a  class = "menu_tag_a" href="/daviddong.github.io/category">
    <span class="icon-tags-1 icon_font">Categories</span>
</a><a  class = "menu_tag_b" href="/daviddong.github.io/about">
    <span class="icon-help-circled-3 icon_font">About</span>
</a>
</div>
</div>
</div><div class="post-container">
  <li class="posts-labelgroup" id="posts-labelgroup">
	<h1 id="posts-label">POST</h1>
  </li>  
  <a class="post-link" href="/daviddong.github.io/android/2015/04/11/Android-read-property.html">
    <h2 class="post-title">Read/Write system property in Android APP</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>Android</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Apr 11, 2015</div>
  </div>
  <!-- post content here! -->
  <!-- if sidebar! -->
  
  <div class="post">
    <p>Recently I need to read system property in my Android apk development. I checked the Android documents and found that Android has a <code class="language-plaintext highlighter-rouge">Systemproperties</code> class to handle this kind of requirement. However <code class="language-plaintext highlighter-rouge">Systemproperties</code> class isn’t a public class of SDK, which means it is invisible to the apk developer. My understanding is that google wants this class to be used for Android source developer rather than application developer.</p>

<p>If I use this class as a source developer, I have to raise my program with root permission and re-build the whole system.</p>

<p>So I applied a trick way to access the <code class="language-plaintext highlighter-rouge">Systemproperties</code> method with the help of Java reflect mechanism.</p>

<p>I studied the source code of <a href="https://www.androidos.net.cn/android/9.0.0_r8/xref/frameworks/base/core/java/android/os/SystemProperties.java">SystemProperties.java</a> and found the methods it implemented.</p>

<p>SystemProperties.java</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="nc">String</span> <span class="nf">native_get</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="nc">String</span> <span class="nf">native_get</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">String</span> <span class="n">def</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">int</span> <span class="nf">native_get_int</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">int</span> <span class="n">def</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">long</span> <span class="nf">native_get_long</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">def</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">native_get_boolean</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">def</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">native_set</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">String</span> <span class="n">def</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">native_add_change_callback</span><span class="o">();</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">native_report_sysprop_change</span><span class="o">();</span></code></pre></figure>

<p>This class defined the set/get methods for different data type. What I need is the get() method of return a String type.</p>

<p>The rest work is straightforward, I wrote below codes and inserted into my class.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.annotation.NonNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.annotation.Nullable</span><span class="o">;</span>
<span class="o">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">DisabledNavigationActivity</span> <span class="o">{</span>
     <span class="kd">private</span> <span class="nc">Logger</span> <span class="n">mLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Logger</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="no">VIBRATE_MS_IMAGE</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
     <span class="kd">private</span> <span class="nc">Handler</span> <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">(</span><span class="nc">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">());</span>
 
     <span class="o">...</span>

	 <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">vendorKey</span> <span class="o">=</span> <span class="s">"my_property"</span><span class="o">;</span>

     <span class="o">...</span>

	<span class="kd">private</span> <span class="kd">interface</span> <span class="nc">PropertiesKeys</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="no">VENDOR</span> <span class="o">=</span> <span class="s">"persist.vendor.sys.fp.vendor"</span><span class="o">;</span>
    <span class="o">}</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="nf">getStringProperty</span><span class="o">(</span>
            <span class="nd">@Nullable</span> <span class="nc">Method</span> <span class="n">systemPropertiesGetString</span><span class="o">,</span>
            <span class="nd">@NonNull</span> <span class="nc">String</span> <span class="n">propertyKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">String</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">systemPropertiesGetString</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">defaultValue</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">systemPropertiesGetString</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span>
                    <span class="kc">null</span><span class="o">,</span> <span class="c1">// No object when calling a static method.</span>
                    <span class="n">propertyKey</span><span class="o">,</span>
                    <span class="n">defaultValue</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mLogger</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="nc">Logger</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                  <span class="s">"Failed to read system property (%s): %s"</span><span class="o">,</span>
                  <span class="n">propertyKey</span><span class="o">,</span>
                 <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">defaultValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">....</span>

     <span class="nd">@Override</span>
     <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
         <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
         <span class="n">mLogger</span><span class="o">.</span><span class="na">enter</span><span class="o">(</span><span class="s">"onCreate"</span><span class="o">);</span>
         <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
 
		<span class="nc">Method</span> <span class="n">sysPropGetString</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
            <span class="c1">// The SystemProperties class is not public in the SDK - access via reflection.</span>
            <span class="kd">final</span> <span class="nc">Class</span> <span class="n">systemProperties</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"android.os.SystemProperties"</span><span class="o">);</span>
            <span class="n">sysPropGetString</span> <span class="o">=</span> <span class="n">systemProperties</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"get"</span><span class="o">,</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mLogger</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="nc">Logger</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                    <span class="s">"Failed to get method system properties: %s"</span><span class="o">,</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
        <span class="o">}</span>

		<span class="nc">String</span> <span class="n">propStr</span> <span class="o">=</span> <span class="n">getStringProperty</span><span class="o">(</span><span class="n">sysPropGetString</span><span class="o">,</span> <span class="nc">PropertiesKeys</span><span class="o">.</span><span class="na">VENDOR</span><span class="o">);</span>

		<span class="n">mLogger</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"the vendor is "</span> <span class="o">+</span> <span class="n">propStr</span><span class="o">);</span>

		<span class="k">if</span><span class="o">(!</span><span class="n">propStr</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">vendorKey</span><span class="o">)){</span>
			<span class="o">...</span>
		<span class="o">}</span>
	
		<span class="o">...</span></code></pre></figure>

  </div>
  

  <br><br><br>
  <!-- Page navigation start here! --><li class="posts-labelgroup" id="posts-labelgroup">
	<h1 id="posts-label">further reading</h1>
  </li> 
  <div class="navigation-meta" style = "margin-bottom:40px"><ul class="navigation-bar" style = "margin-top:40px; min-width:40%">   
	 <a href="/daviddong.github.io/android/2015/02/25/Android-getevent.html"; style="width:100%"><font size="1px" color="#777">Previous Post</font><br>Getevent command usage</a>
    </ul><ul class="navigation-bar" style = "margin-top:40px; min-width:40%">   
     <a href="/daviddong.github.io/github/2015/06/06/Github-gitignore.html"; style="width:100%"><font size="1px" color="#777">Next Post</font><br>A way to fix .gitignore doesn&#39;t work</a>
    </ul></div><br>
  <!-- comment box starts here! -->
    <!-- disqus start  --><!-- Gitalk start  -->
  <!-- Link Gitalk support file  -->
  <section class="gitalk">
  <div id="gitalk_thread"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script type="text/javascript" src="/daviddong.github.io/assets/js/md5.min.js"></script>
  <div id="gitalk-container"></div>
  <script type="text/javascript">
   var gitalk = new Gitalk({
   // gitalk parameters
   clientID: '5e24fc307693a6df3bc5',
   clientSecret: '28c9c17e1174c705c42e9bdc92f87cadcc4ec8b8',
   repo: 'daviddong.github.io',
   owner: 'gangdong',
   admin: ['gangdong'],
   id: md5(location.pathname),
   title: 'comments'
    });
   gitalk.render('gitalk-container');
  </script>
  </section>
  <!-- Gitalk end -->
  <br/><br/><br/><div class = "footer">© 2012-2021 David Dong. All rights reserved.</div>
  
  <br>
</div>

      </section>
    </main>
<script src="/daviddong.github.io/assets/js/simple-jekyll-search.min.js"></script>
<script src="/daviddong.github.io/assets/js/search.js"></script>
<link href="/daviddong.github.io/assets/css/vim.css" rel="stylesheet"/>

  </body>
</html>
