<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="keywords"  content="董刚, DavidDong, David, 董刚的博客, David Dong's Blog, 博客, 个人网站, 互联网, Web, 手机, 人机接口, Touch, Fingerprint，Github Pages TEE Java Python C Android">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Use Travis CI to build and deploy project automatically on Github | David Dong’s Blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Use Travis CI to build and deploy project automatically on Github" />
<meta name="author" content="david.dong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This article is about Travis CI. Travis CI is a Continuous Integration (CI) tool that can help you build, test and deploy your software project automatically. This article will introduce how to use Travis CI." />
<meta property="og:description" content="This article is about Travis CI. Travis CI is a Continuous Integration (CI) tool that can help you build, test and deploy your software project automatically. This article will introduce how to use Travis CI." />
<link rel="canonical" href="http://localhost:4000/blog/github/2020/04/01/Blog-travisci.html" />
<meta property="og:url" content="http://localhost:4000/blog/github/2020/04/01/Blog-travisci.html" />
<meta property="og:site_name" content="David Dong’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-01T13:02:34+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Use Travis CI to build and deploy project automatically on Github" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"david.dong"},"dateModified":"2020-04-01T13:02:34+08:00","datePublished":"2020-04-01T13:02:34+08:00","description":"This article is about Travis CI. Travis CI is a Continuous Integration (CI) tool that can help you build, test and deploy your software project automatically. This article will introduce how to use Travis CI.","headline":"Use Travis CI to build and deploy project automatically on Github","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/github/2020/04/01/Blog-travisci.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/logo.png"},"name":"david.dong"},"url":"http://localhost:4000/blog/github/2020/04/01/Blog-travisci.html"}</script>
<!-- End Jekyll SEO tag -->



<meta property="article:tag" content="Blog">

<meta property="article:tag" content="Github">


<link href="https://fonts.font.im/css?family=Poppins:400,900|Raleway|Roboto:400,900|Roboto+Mono&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://rsms.me/">
<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="icon" href="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/favicon.ico">

	<!-- default stylesheet monokai.sublime ! -->
	
	<link href="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/css/syntax/syntax.monokai.sublime.css" rel="stylesheet"/>
	

<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.0/dist/jquery.min.js"></script>

</head><body>
    <main class="container">
      <section class="about condensed">
	    <div class="about-header condensed">
			<div class="about-title">
				<a href="/blog/index.html">
				  <img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/avatar-11.png" alt="David Dong"/>
				</a>
				<div class = "title-meta">
					<h2 id="title">
					  <a href="/blog/index.html">David Dong</a>
					</h2>
					<p class = "tagline-small">Java/C/C#/Python</p>
				</div>
			</div>
			<p class="tagline">Java/C/C#/Python</p>
		</div>
		<!--put dark mode button here -->
		<div class = "about-footer condensed">
		  <!--put rss/code link here -->
			<div class="icon-box-container about-footer condensed"><div class = "icon-box" style = "padding-right:0px">
					<a id="dark-mode-toggle" class="togglemode dark-mode" onclick="toggleDarkMode()">
						<span id = "mode">Dark Mode</span>
					</a>
				</div>
				<!-- toggle dark/light display mode, should loading darkmode.js here for avoiding flicker when switching -->
				<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/js/darkmode.js"></script>
				<script type="text/javascript">
				$('.dark-mode').on('click',function(){
					$('.dark-mode').toggleClass('light-mode');
					if (document.getElementById("mode").innerHTML=="Light Mode")
						document.getElementById("mode").innerHTML="Dark Mode";
					else 
						document.getElementById("mode").innerHTML="Light Mode";
				})
				</script><div class = "icon-box">
					<a class="icon-rss" href="/rss.xml">
						<span>Subscribe</span>
					</a>
				</div><div class = "icon-box">
					<a class="icon-file-code" href="https://github.com/gangdong/gangdong.github.io">
						<span>Source Code</span>
					</a>
				</div></div>
		</div>
		
	    <!--show contact me -->
		<div class = "about-footer condensed social-container">
	    <p class = "contact about-footer condensed">CONTACT ME</p>
		<!-- put social link here -->
	      <ul class="social about-footer condensed" >
		   <a href="https://rainbow-ux.github.io/traveler-blog.github.io">
              <li>
                <i class="icon-picture"></i>
              </li>
           </a><a href="https://github.com/gangdong">
              <li>
                <i class="icon-github-circled"></i>
              </li>
            </a><a href="https://www.linkedin.com/in/刚-董-25208ba0/">
              <li>
                <i class="icon-linkedin-squared"></i>
              </li>
            </a><a href="mailto:dqdongg@hotmail.com">
              <li>
                <i class="icon-mail" style = "font-size: 27px"></i>
              </li>
            </a></ul>
		<!--put timestamp here -->
		<p class ="timestamp about-footer condensed">&copy; 2024</p>
		</div>
	  <!-- about box end here -->
      </section>
	  
      <section class="content">
        


<!-- add menu bar here! -->
<div class="post-container">
	<div  class = "menu-meta condensed">
		<!--put top menu here, display @ big screen (> $mobileW) -->
		<div  class = "menu-logo">BLOG</div>
		<div  class = "menu">
			<a href="/blog/index.html">
				<li class="icon-home">Home</li>
			</a><a href="/archive">
				<li class="icon-archive">Archives</li>
			</a><a href="/category">
				<li class="icon-tags">Categories</li>
			</a><a href="/about">
				<li class="icon-help-circled">About</li>
			</a>
		</div>
		<!--put hide menu button here, display @ small screen (< $mobileW) -->
		<div class = "menu-btn-box"><a class="menu-btn"></a></div>
		<!--put hide menu here, display @ small screen (< $mobileW) -->
		<div class="context-menu">
			<ul >
				<li>
					<a class="icon-home" href="/blog/index.html">Home</a>
				</li><li>
					<a class="icon-archive" href="/archive">Archives</a>
				</li><li>
					<a class="icon-tags" href="/category">Categories</a>
				</li><li>
					<a class="icon-help-circled" href="/about">About</a>
				</li>
			</ul>
		</div>
	</div>
</div>
<script type="text/javascript">
$('.menu-btn').on('click',function(e){
		
	e.stopPropagation();
	var tag = $('.context-menu');		
	$(tag).toggleClass('context-menu-show');
			
	var flag = true;
	/* hide the context-menu when other element is clicked */
	$(document).bind('click',function(e){
		var target = $(e.target);
		if(target.closest(tag).length == 0 && flag == true){
			$(tag).toggleClass('context-menu-show');
			flag = false;
		}
	});
})
</script><div class="post-container" style = "margin-bottom:1rem">
	<div class="posts-labelgroup" id="posts-labelgroup">
		<h1 id="posts-label">POST</h1>
	</div>  
	<!-- post title -->
	<h2 class="post-title-body">Use Travis CI to build and deploy project automatically on Github</h2>
	<div class="post-meta">
		<div class="post-date icon-calendar" style = "padding-left:0px;font-size:14px">Apr 1, 2020</div>
		
		<!-- sidebar button for displaying/hiding sidebar -->
		<div class = "sidebar-btn-box"><a class="btn"></a></div>
		
	</div>
</div>
  <!-- post content here! -->
  <!-- set fix width box to put content! -->
<div class="post-viewer-container">
	<div class="post post-fix-width">
		<p>This article will introduce how to use <a href="https://www.travis-ci.com/">Travis CI</a> to build, test and deploy the Github project automatically. I will take my blog project on Github as an example to explain.</p>

<h2 id="why-do-i-use-travis-ci-">Why do I use Travis CI ?</h2>

<p>If you’ve looked at my previous article, you may know my blog was deployed on Github Pages and was built by Jekyll static site generator.</p>

<p>Github Pages are a great approach to build websites. Using a Github repository and with the Jekyll static site generator, we can build static websites easily. It is suitable for building a personal blog.</p>

<p>Although Github Pages can automatically generate a website from a repository containing a Jekyll project, it has some limitations.</p>

<div class="post-note info">
  <div class="header"></div>
  <div class="body">
  <p>To deploy the blog on Github Pages, you just need to commit your website's source code to the Github Repo and don't pay any effort on the building and deployment.<br />Github Pages will do it for you! </p>
  </div>
</div>

<p>One of them is</p>

<ul>
  <li><em>we can’t use Jekyll plugins</em></li>
</ul>

<p>I need to use plugins to extend the functionality of my website, e.g. for implementation of toc and markdown function enrichment.</p>

<p>Understandably,Github Pages doesn’t allow the plugin for security reasons.</p>

<div class="post-note info">
  <div class="header"></div>
  <div class="body">
  <p>Github Pages Generator uses the Jekyll <span>--safe</span> flag.</p>
  </div>
</div>

<p>The workaround is to generate the site locally and then to push the generated HTML to Github (<em>I’ve interpreted how to do in my previous <a href="/blog/github/2018/12/29/Blog-Jekyll-toc-plugin.html">article</a></em>). However, I usually use different branches for source code and output static HTML. The <code class="language-plaintext highlighter-rouge">dev</code> branch accommodates the source code and the <code class="language-plaintext highlighter-rouge">gh-pages</code> branch, which is as a window of website visiting, stores the static website files.</p>

<p>So my current workflow is</p>

<ul>
  <li>modify the source code at the dev branch and use Jekyll build locally.</li>
  <li>commit the change to the dev branch.</li>
  <li>copy the output static website files which are in the <code class="language-plaintext highlighter-rouge">_site</code> folder to \tmp folder.</li>
  <li>switch to the local gh-pages branch.</li>
  <li>add copied static website file in <code class="language-plaintext highlighter-rouge">_site</code> folder to the gh_pages branch.</li>
  <li>git add &amp; commit.</li>
  <li>push to the remote gh-pages branch.</li>
</ul>

<p>or I can push the files in <code class="language-plaintext highlighter-rouge">_site</code> to the remote gh-pages branch forcibly from the dev branch although it is not an ideal way of routine operation.</p>

<p>You see it! ☹️ Really tedious, isn’t it?</p>

<p>I think it is a poor efficiency and should be improved.</p>

<p>The main motivation for me is to be able to get a tool that helps me do the above works automatically. What I want to do is just committing the code to the remote dev branch (<em>this is the necessary work</em>) and others leave to the tool.</p>

<p>The basic idea is to use the <a href="https://docs.travis-ci.com/user/for-beginners/">Travis CI continuous integration (CI)</a> service. The function of Travis CI service fully meets my expectation. And the most important point is that it is <em>FREE</em> for open-source projects in Github.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>To start using Travis CI, make sure you have:</p>

<ul>
  <li>Github account</li>
  <li>
    <p>Adding authentication methods to your Github account. You can do it by creating a personal access token (PATs) or connecting to GitHub with SSH Key. If you don’t know how to do, please refer to</p>

    <ul>
      <li><a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">Creating a personal access token (PATs)</a></li>
      <li><a href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh">Connecting to GitHub with SSH</a>  <br />
  <br /></li>
    </ul>
  </li>
  <li>Travis CI account and <a href="https://docs.travis-ci.com/user/migrate/open-source-on-travis-ci-com/">sign up</a>, you can use your Github account ID to log in directly.</li>
  <li>
    <p>Authorize the Travis CI (<em>you will be requested to do it when you sign in to Travis CI for the first time</em>), active your Github repositories that you want to use Travis CI service. Please refer to</p>

    <ul>
      <li><a href="https://docs.travis-ci.com/user/tutorial#travis-ci-github-oauth-app-access-rights">To get started with Travis CI using GitHub</a>  <br />
  <br /></li>
    </ul>
  </li>
  <li>One local git repository for your project.</li>
</ul>

<h2 id="workflow">Workflow</h2>

<p>The workflow of Travis CI building and deployment is as follows:</p>

<ul>
  <li>git push to the Github repo triggers Travis CI</li>
  <li>Travis CI starts up a virtual machine and installs all required software (<em>mostly Ruby gems</em>)</li>
  <li>I use a custom rake task to tell Travis CI how to build the Jekyll site and push the updated content back to Github</li>
  <li>Travis CI clones a different branch (<em>either dev or master, depending on the kind of Github repo</em>) that holds the website’s source code.</li>
  <li>Travis CI runs Jekyll build with the destination in the other branch (<em>gh-pages</em>)</li>
  <li>Travis CI does a git push of the other branch (<em>gh-pages</em>)</li>
  <li>Github Pages starts serving the updates site</li>
</ul>

<p>Depending on the required software that needs to be installed, the whole process takes anywhere between 1 and 5 min and is fully automated.</p>

<h3 id="travisyml">.travis.yml</h3>
<p>Travis CI uses the .travis.yml file to describes the build process. Create a .travis.yml into your project’s repo and edit it.</p>

<p>Don’t forget to commit it and push it to the remote repo once you finished editing!</p>

<h3 id="lifecycle">Lifecycle</h3>
<p>The whole job’s life cycle can be divided into several phases.</p>

<p>The main phases are:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">install</code> - install any dependencies required</li>
  <li><code class="language-plaintext highlighter-rouge">script</code> - run the build script</li>
</ol>

<p>You can complete basic work with the above minimal life cycle. Besides, Travis CI affords some phases that allow users to insert custom commands.</p>

<div class="post-note info">
  <div class="header"></div>
  <div class="body">
    <p>To get to know the details and learn how to write <span style="color:#c7254e;">.travis.yml</span> file, please read 
      <ul>
	    <li><a href="https://docs.travis-ci.com/user/job-lifecycle/">Travis CI Job Lifecycle</a></li>
      </ul>
    </p>
  </div>
</div>

<h3 id="sensitive-data">Sensitive Data</h3>

<p>Travis CI will inevitably use the sensitive data (<em>for example, SSH private key or Github personal access token</em>) to access the Github. Of course, we cannot expose the data without any protection. Travis CI provides <a href="https://docs.travis-ci.com/user/encryption-keys/">encryption scheme</a> to protect your secret information.</p>

<p>Travis CI offers commands that can encrypt the private key or any files. You can also save your sensitive data to <a href="https://docs.travis-ci.com/user/environment-variables/">environment variables</a>, where the data is invisible and can be accessed from any stage in your build process.</p>

<p>For my project, I’ve tried two methods as below:</p>

<ul>
  <li>use SSH scheme access Github with RSA key pairs</li>
  <li>access with encrypted Github PATs (<em>personal access tokens</em>)</li>
</ul>

<h4 id="ssh">SSH</h4>

<p>For SSH access, I assume you have created SSH key pairs and it is workable for your Github. If you don’t have, do it by following</p>

<ul>
  <li><a href="https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key">Generating a new SSH key and adding it to the ssh-agent</a></li>
</ul>

<p>you can test the connection status by inputting the command.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ssh <span class="nt">-T</span> git@github.com</code></pre></figure>

<p>If you get a message like this, you are accessing Github successfully.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="s2">"Hi [secure]/your repo name ! You have successfully authenticated, but GitHub does not provide shell access."</span></code></pre></figure>

<p>Then use the below command that Travis CI provides to encrypt the private key.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Sign in travis-ci.com</span>
travis login <span class="nt">--com</span>  <span class="nt">--github-token</span> <span class="s2">"your github personal access keys (*PATs*)"</span> 
<span class="c"># encrypt the SSH private key</span>
travis encrypt-file <span class="s2">"your private key"</span> <span class="nt">--add</span></code></pre></figure>

<p>Above commands sign in Travis CI (<em>for applying the APIs</em>), encrypt the private key, and generate a code snippet (<em>as below</em>) into your <code class="language-plaintext highlighter-rouge">.travis.yml</code> file to decrypt the private key during the building process.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">openssl aes-256-cbc <span class="nt">-K</span> <span class="nv">$encrypted_70fbe34e406c_key</span> <span class="nt">-iv</span> <span class="nv">$encrypted_70fbe34e406c_iv</span> <span class="nt">-in</span> blog_id_rsa.enc <span class="nt">-out</span> blog_id_rsa <span class="nt">-d</span></code></pre></figure>

<p>then add your SSH private key to the ssh-agent.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># start the ssh-agent in the background</span>
<span class="nb">eval</span> <span class="sb">`</span>ssh-agent <span class="nt">-s</span><span class="sb">`</span>
ssh-add blog_id_rsa</code></pre></figure>

<p>After generated the encrypted key leave it into your code repo.</p>

<div class="post-note warning">
  <div class="header"></div>
  <div class="body">
  	<p>Do not forget to remove your <span style="font-style: italic; font-weight: bold; color: #eb0f00">PRIVATE KEY</span> before you commit code to Github Repo!<br />Otherwise, you may potentially disclose your private key.</p>
  </div>
</div>

<h4 id="pats">PATs</h4>

<p>If using PATs, you should follow below steps:</p>

<ul>
  <li>
    <p>acquire a PAT, refer to</p>

    <ul>
      <li><a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">Creating a personal access token (PATs)</a></li>
    </ul>

    <p>remember to keep this token’s value carefully since it is only visible for the first time generated.</p>
  </li>
  <li>
    <p>encrypt the PAT by inputting the command</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">travis encrypt <span class="nt">-r</span> &lt;user name&gt;/&lt;repo name&gt; <span class="nv">GH_TOKEN</span><span class="o">=</span> <span class="s2">"value of PATs"</span></code></pre></figure>

<p>This will output a string looking something like this:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">secure: <span class="s2">".... encrypted data ...."</span></code></pre></figure>

<p>Now you can place it in the <code class="language-plaintext highlighter-rouge">.travis.yml</code> file.</p>

<p>You can also skip the above, and add it automatically by running:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">travis encrypt <span class="nt">-r</span> &lt;user name&gt;/&lt;repo name&gt; <span class="nv">GH_TOKEN</span><span class="o">=</span>PAT <span class="nt">--add</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">GH_TOKEN</code> is the environment variable, which can be accessed in the <code class="language-plaintext highlighter-rouge">.travis.yml</code> file.</p>

<p><code class="language-plaintext highlighter-rouge">GH_REF</code> environment variable can be set to “github.com/<code class="language-plaintext highlighter-rouge">user-name</code>/<code class="language-plaintext highlighter-rouge">repo-name</code>.git”.</p>

<p>Please note that the name of the environment variable and its value are both encoded in the string produced by “travis encrypt.” You must add the entry to your <code class="language-plaintext highlighter-rouge">.travis.yml</code> with key <code class="language-plaintext highlighter-rouge">secure</code> (<em>underneath the <code class="language-plaintext highlighter-rouge">env</code> key</em>). This makes the environment variable <code class="language-plaintext highlighter-rouge">GH_TOKEN</code> with the value of PATs available to your program.</p>

<p>Once you got the personal access token and encrypted, you can access the Github repo by the below method:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">https://<span class="k">${</span><span class="nv">GH_TOKEN</span><span class="k">}</span>@<span class="k">${</span><span class="nv">GH_REF</span><span class="k">}</span><span class="s2">" travis:gh-pages</span></code></pre></figure>

<p>With this method, you can avoid being request passphrase when accessing.</p>

<h3 id="example">Example</h3>
<p>I attached my blog project’s <a href="https://github.com/gangdong/daviddong.github.io/blob/master/.travis.yml">.travis.yml</a> file here as an example.</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">2.6.6</span>
<span class="na">before_install</span><span class="pi">:</span>
<span class="c1"># decrypt private key</span>
<span class="pi">-</span> <span class="s">openssl aes-256-cbc -K $encrypted_70fbe34e406c_key -iv $encrypted_70fbe34e406c_iv -in blog_id_rsa.enc -out blog_id_rsa -d</span>
<span class="c1"># add permission </span>
<span class="pi">-</span> <span class="s">chmod 600 blog_id_rsa</span>

<span class="c1"># kick off ssh-agent</span>
<span class="pi">-</span> <span class="s">eval "$(ssh-agent -s)"</span>
<span class="pi">-</span> <span class="s">ssh-add blog_id_rsa</span>
<span class="c1"># remove</span>
<span class="pi">-</span> <span class="s">rm blog_id_rsa</span>
<span class="na">install</span><span class="pi">:</span> <span class="s">gem install jekyll</span>

<span class="na">script</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">bundle install</span>
<span class="pi">-</span> <span class="s">bundle exec jekyll build</span>

<span class="c1">#deploy:</span>
<span class="c1">#  provider: script</span>
<span class="c1">#  skip_cleanup: true</span>
<span class="c1">#  script: bash scripts/deploy.sh</span>
<span class="c1">#  on:</span>
<span class="c1">#    branch: dev</span>
<span class="na">after_success</span><span class="pi">:</span>
<span class="c1"># check the connection to host</span>
<span class="pi">-</span> <span class="s">ssh -T git@github.com</span>

<span class="c1"># add user account</span>
<span class="pi">-</span> <span class="s">git config user.name "${USER}"</span>
<span class="pi">-</span> <span class="s">git config user.email "${EMAIL}"</span>

<span class="c1"># copy _site to tmp</span>
<span class="pi">-</span> <span class="s">cp -r /home/travis/build/${USER}/daviddong.github.io/_site  /tmp/</span>
<span class="c1"># create new branch</span>
<span class="pi">-</span> <span class="s">git checkout -b travis</span>
<span class="c1"># clean </span>
<span class="pi">-</span> <span class="s">rm -rf *</span>
<span class="c1"># copy _site </span>
<span class="pi">-</span> <span class="s">cp -r /tmp/_site/* ./</span>
<span class="pi">-</span> <span class="s">ls -la</span>
<span class="c1"># git add &amp; commit</span>
<span class="pi">-</span> <span class="s">git add -A</span>
<span class="pi">-</span> <span class="s">git commit -m "travis_ci update gh-pages dev -&gt; 3457aec"</span>
<span class="c1"># push remote </span>
<span class="pi">-</span> <span class="s">git push --force "https://${GH_TOKEN}@${GH_REF}" travis:gh-pages</span>

<span class="c1"># branch whitelist, </span>
<span class="na">branches</span><span class="pi">:</span>
  <span class="na">only</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">master</span>     <span class="c1"># monitor master branch</span>
  <span class="pi">-</span> <span class="s">dev</span>        <span class="c1"># monitor dev branch</span>
<span class="na">addons</span><span class="pi">:</span> <span class="s">ssh_known_hosts:daviddong.github.io</span>
<span class="c1"># caching bundler gem packages will speed up b</span>
<span class="na">cache</span><span class="pi">:</span> <span class="s">bundler</span>
<span class="c1"># Optional: enable email notifications about the outcome of your builds</span>
<span class="na">notifications</span><span class="pi">:</span>
  <span class="na">email</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">global</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">secure</span><span class="pi">:</span> <span class="s">NiBbDRjSP7+KRko5wT0uOfSiS4GqdyLzEBFa/95OdN8mCrEslnAPS2aMWNdm5FBqMh4sotR31KCXtgnvQUk0NhxCEdNLYLvv6lK9MA2oLRhhQaeYMQjeGvCGmZyScew3cLNRdo9rn/9wXVNtZM0YUZ+CTJbpZS+jyC3KfndganTE4PPpkel/BS1BnDt8HGaioeyik805CK3bAmXClYjD/+sPaxAL6dS4BJEZzge16JK3IcJepYY+wCgzWtqhsSmHfqxJ8mFodKh8hNSQRNyOiT7G+kX8GiA7Hl5kZdd4Qia7V8ct/ovOhxL/QkVWQYp7uukjg8ugQgq02SYcMdMs86SodSmdSD6cYez5CCnmpDqfFh8SXOcNyAfqQf7MGmItI9WraTNPWPfkv5pUp/7go/ZnfGNUobnDdZh5B5cVr5xogif+B4UI2vpesZmf6IXH+XntlHlfh2x/DG6hSwywUJEEQLGJjsfiAkdQ2jbQZ9WylbNNFovT0Px2jZaetOQ9cD3ekVCjyPHfW4/vfqx6cfr2kdGjxEiQghfyfQ5bV05gJXKNfDenWFNMI4X+L0ELITjJb+q+l1L8CKF0KLjfh7lJsqWMV61qU7QCM7siU1f7KvUZCKjtNu4Wot4A11O+a5HaCzSjf7zQTuIrRwFb4srLf39rRIqU5agtxzBxAOA=</span></code></pre></figure>

<p>OK, everything is done here!</p>

<p>Let’s see what happens!</p>

<p>I modify code and push to the remote dev branch, open my Travis CI web page to view the building process.</p>

<p>Yes, my commit event to the <code class="language-plaintext highlighter-rouge">dev</code> branch triggers Travis CI to work for the building.</p>

<p><img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/image/blog-travisci-01.PNG" alt="startup" class="center-image" /></p>

<p>Booting virtual machine …</p>

<p><img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/image/blog-travisci-02.PNG" alt="startup" class="center-image" /></p>

<p>Setting environment variable…
<img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/image/blog-travisci-03.PNG" alt="startup" class="center-image" /></p>

<p>Continue waiting…, oh! start to decryption and install toolchain…
<img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/image/blog-travisci-04.PNG" alt="startup" class="center-image" /></p>

<p>Installation completed, building now…
<img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/image/blog-travisci-05.PNG" alt="startup" class="center-image" /></p>

<p>Building succeed! The last step, deploy…
<img src="https://cdn.jsdelivr.net/gh/gangdong/gangdong.github.io@dev/assets/image/blog-travisci-06.PNG" alt="startup" class="center-image" /></p>

<p>It’s done! Looks like the whole process was completed successfully! 👍</p>

<p>Let me go to the Github gh-pages repo to check the result.</p>

<p>GREAT! 😄</p>

<p>The repo was updated successfully with the new contents.</p>

<p>The Travis CI works well, which means I can get back to the normal workflow to develop my blog without extra git operation between different branches.</p>

<p>The workflow is not only valid for blog projects deployed on Github Pages but any open source projects on Github.</p>

<p>The last thing is don’t forget to add a Travis CI logo/link to your README.</p>

<p><a href="https://travis-ci.com/gangdong/gangdong.github.io"><img src="https://travis-ci.com/gangdong/gangdong.github.io.svg?branch=dev" alt="Build Status" /></a></p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>Building Errors:</p>

<ul>
  <li>Error: <code class="language-plaintext highlighter-rouge">iv undefined</code> when executing <code class="language-plaintext highlighter-rouge">openssl</code> command.<br /><br />
Possible Reason:
    <ul>
      <li>check the Travis CI website address, it should be <code class="language-plaintext highlighter-rouge">https://travis-ci.com</code> rather than <code class="language-plaintext highlighter-rouge">https://travis-ci.org</code>.</li>
      <li>run <code class="language-plaintext highlighter-rouge">travis login --com</code> instead of <code class="language-plaintext highlighter-rouge">travis login --org</code> to log in Travis CI.</li>
      <li>check the configuration file <code class="language-plaintext highlighter-rouge">~/.travis/config.yml</code>, the value of endpoint should be <code class="language-plaintext highlighter-rouge">https://api.travis-ci.com/</code>.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="na">repos</span><span class="pi">:</span>
<span class="err">	</span><span class="na">endpoint</span><span class="pi">:</span> <span class="s">https://api.travis-ci.com/</span></code></pre></figure>

<ul>
  <li>
    <p>Error: Being asked for entering passphrase for key <code class="language-plaintext highlighter-rouge">/root/.ssh/id_rsa</code> when executing <code class="language-plaintext highlighter-rouge">openssl</code> command to do decryption of the SSH private key.<br /><br />
It is because you set the passphrase when generating the SSH key, use <code class="language-plaintext highlighter-rouge">ssh-keygen -p</code> command to reset the passphrase to <code class="language-plaintext highlighter-rouge">none</code>.
Then replace the private key with the new one and re-encrypt the private key.</p>
  </li>
  <li>
    <p>Error: report <code class="language-plaintext highlighter-rouge">the encrypted_xxx file size is incorrect</code> when decryption. <br /><br />
Probably you are using the wrong format encryption file, the Travis CI host is running on Ubuntu OS. So the file format should be UNIX, if you generate an encryption file with DOS format, you will encounter this issue. <br /><br />
The solution is to use <code class="language-plaintext highlighter-rouge">dos2unix</code> or <code class="language-plaintext highlighter-rouge">fromdos</code> command to convert the format to UNIX.</p>
  </li>
  <li>
    <p>Error: you got <strong><em>repository not known to https://api.travis-ci.org/: user-name/repo-name</em></strong> when you execute the command</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="s">travis encrypt -r 'user-name'/'repo-name' DEPLOY_TOKEN = 'your PATs'</span></code></pre></figure>

<p>It is because your current repo is not in the repo’s list in the config.yml, add your repo’s name into the config.yml and indicate the endpoint to <code class="language-plaintext highlighter-rouge">https://api.travis-ci.com/</code> manually.</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="na">repos</span><span class="pi">:</span>
  <span class="na">gangdong/daviddong.github.io</span><span class="pi">:</span>
    <span class="na">endpoint</span><span class="pi">:</span> <span class="s">https://api.travis-ci.com/</span>
  <span class="na">gangdong/sort-algos</span><span class="pi">:</span>
    <span class="na">endpoint</span><span class="pi">:</span> <span class="s">https://api.travis-ci.com/</span></code></pre></figure>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://jekyllrb.com/docs/continuous-integration/travis-ci/#troubleshooting">Travis CI</a></li>
  <li><a href="https://notes.iissnan.com/2016/publishing-github-pages-with-travis-ci/">publishing-github-pages-with-travis-ci</a></li>
  <li><a href="https://mritd.com/2017/02/25/jekyll-blog-+-travis-ci-auto-deploy/">jekyll-blog-+-travis-ci-auto-deploy</a></li>
</ul>

	</div>
	<!-- put sidebar! -->
	
	<div class = "sidebar-container">
	    
	    <div class = "sidebar-about-box" id = "sidebar">
		    
				<p class = "sidebar-title">About This Article</p>
			
			
				
					<P class = "sidebar-about-content sidebar-font-big">This article is about Travis CI. <br><br>Travis CI is a Continuous Integration (CI) tool that can help you build, test and deploy your software project automatically. <br><br>This article will introduce how to use Travis CI.</P>
				
				
					<P class = "icon-link sidebar-about-content sidebar-font-medium" style = "margin-top:30px">Author: <a href="https://github.com/gangdong">david.dong</a></P>
				
					<P class = "icon-clock sidebar-about-content sidebar-font-medium">28 mins to read</P>
					<P class = "icon-book-1 sidebar-about-content sidebar-font-medium">10955 words</P>
				
					<P class = "icon-th-list sidebar-about-content sidebar-font-medium">Key Words: Travis CI/Github</P>
				
				
				    <P class = "icon-hashtag sidebar-about-content sidebar-font-medium">Tags: 
					
					<a href="/category#Blog">Blog&nbsp;</a>
					
					<a href="/category#Github">Github&nbsp;</a>
					
					</P>
				
			
		</div>
		
		
	    <div class="sidebar-toc-box">
			
			<p class = "sidebar-title">Table of Contents</p>
			<span class = "sidebar-font-medium sidebar-toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#why-do-i-use-travis-ci-">Why do I use Travis CI ?</a></li>
<li class="toc-entry toc-h2"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-entry toc-h2"><a href="#workflow">Workflow</a>
<ul>
<li class="toc-entry toc-h3"><a href="#travisyml">.travis.yml</a></li>
<li class="toc-entry toc-h3"><a href="#lifecycle">Lifecycle</a></li>
<li class="toc-entry toc-h3"><a href="#sensitive-data">Sensitive Data</a>
<ul>
<li class="toc-entry toc-h4"><a href="#ssh">SSH</a></li>
<li class="toc-entry toc-h4"><a href="#pats">PATs</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#example">Example</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#troubleshooting">Troubleshooting</a></li>
<li class="toc-entry toc-h2"><a href="#reference">Reference</a></li>
</ul></span>
			
		</div>
		
	</div>
	 
</div>
<!-- no sidebar, use flex width box! -->
<br>
<div class="post-container">
    <!-- post categories box! here  -->
    
   <div class="post-categories-meta">
		<div class="post-categories-box post-categories-box-hide"><a href="/category#Blog">Blog</a><a href="/category#Github">Github</a></div>
	</div>
  
  
  <div class = "share-box-meta">
  <!-- Go to www.addthis.com/dashboard to customize your tools -->
	
	<div class="addthis_inline_share_toolbox share-box"><span style ="padding: 2px">Share:</span></div>
	
	<!-- Put post veiw statistic here! -->
	<div class = "post-view">
	
		<span class = "icon-eye tooltip"><p class = "tooltiptext" style = "left:0%; margin-left: 0px">Viewers</p><span id="busuanzi_value_page_pv"></span></span>
		
	</div>
  </div>
  
  <!-- Related posts start here! -->
		
		<h1 id="posts-label">You may also like</h1>
		
	  <div class = "related-posts-box">
		<ul>
			
			<li><a href="/blog/github/web/2021/05/04/Blog-github-action.html">CI platform migration: from Travis CI to GitHub Actions</a></li>
			
			<li><a href="/blog/github/2018/12/29/Blog-Jekyll-toc-plugin.html">Use jekyll-toc plugin on Github Pages</a></li>
			
			<li><a href="/blog/github/2018/03/23/Github-github-blog.html">How to build your personal blog on Github Pages</a></li>
			
			<li><a href="/github/2015/06/06/Github-gitignore.html">A way to fix .gitignore doesn&#39;t work</a></li>
			
			<li><a href="/blog/web/2021/04/10/Blog-speeding-up-loadtime.html">Speeding up my blog loadtime</a></li>
			
		</ul>
	  </div>
	  
	
  <!-- Page navigation start here! -->
   <h1 id="posts-label">further reading</h1>
  
  <div class = "separator"></div>
  <div class="navigation-meta"><div class="navigation-bar">
	 
	 <a href="/android/fingerprint/2020/01/09/Fingerprint-impl-AN8.0.html"><span>Previous Post</span><br>Fingerprint implementation in android 8.0 and later</a>
	 
    </div><div class="navigation-bar"> 
	 
     <a href="/others/2020/04/23/Others-album.html"><span>Next Post</span><br>My album is online now!</a>
	 
    </div></div><br>
  <!-- comment box starts here! -->
    <!-- disqus start  --><!-- Gitalk start  -->
  <!-- Link Gitalk support file  -->
  <section class="gitalk">
  <div id="gitalk_thread"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script type="text/javascript" src="/assets/js/md5.min.js"></script>
  <div id="gitalk-container"></div>
  <script type="text/javascript">
   var gitalk = new Gitalk({
   // gitalk parameters
   clientID: '5e24fc307693a6df3bc5',
   clientSecret: '28c9c17e1174c705c42e9bdc92f87cadcc4ec8b8',
   repo: 'gangdong.github.io',
   owner: 'gangdong',
   admin: ['gangdong'],
   id: md5(location.pathname),
   title: 'comments'
    });
   gitalk.render('gitalk-container');
  </script>
  </section>
  <!-- Gitalk end -->
  <br/><br/><br/><div class = "footer">© 2012-2021 David Dong. All rights reserved.</div>
  
  <br>
</div>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script async type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-604f502a8198c9c9&domready=1"></script>


<!-- sidebar button, toggle display/hide sidebar -->
<script type="text/javascript">
        $('.btn').on('click',function(){
            $('.btn').toggleClass('btnc');
            $('.sidebar-container').toggleClass('sidebar-container-hide');
        })
</script>

      </section>
    </main><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MXGF3F8QN"></script>
      <script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'G-3MXGF3F8QN');
	</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body>
</html>
